/* Tailwind v4: 使用 @import 作为入口 */
@import "tailwindcss";

/* Include KaTeX styles globally so math renders consistently and avoids TS CSS import issues */
@import "katex/dist/katex.min.css";

/* Self-host Material Symbols via npm package (no CDN) */
@import "material-symbols/index.css";

/* Self-host Inter via @fontsource (no CDN) */
@import "@fontsource/inter/400.css";
@import "@fontsource/inter/500.css";
@import "@fontsource/inter/600.css";
@import "@fontsource/inter/700.css";
@import "@fontsource/inter/800.css";

/* 在 v4 中，dark 变体默认基于媒体查询。如需基于类名触发（.dark），使用自定义变体定义 */
@custom-variant dark (.dark &);

/* 指定内容源，确保扫描 TSX/JSX 文件以生成正确的样式 */
@source "../index.html";
@source "../index.tsx";
@source "../App.tsx";
@source "../{pages,components,hooks,services,utils}/**/*.{ts,tsx,js,jsx}";

/* 变量作为任意值：v4 使用括号语法
   示例：.bg(--brand-color) */

/* 设计令牌：将 v3 的 theme 扩展迁移到 @theme */
@theme {
  --color-primary: #333333;
  --color-background-light: #ffffff;
  --color-background-dark: #111111;
  --color-heymean-l: #F0F0F0;
  --color-heymean-d: #2C2C2C;
  --color-primary-text-light: #333333;
  --color-primary-text-dark: #ffffff;
  --color-thinking-dark: #1A2B21;
  --color-thinking-text-dark: #A6E0B3;

  --font-display: Inter, sans-serif;

  --radius: 0.5rem;
  --radius-lg: 1rem;
  --radius-xl: 1.5rem;
  --radius-2xl: 2rem;
  --radius-full: 9999px;

  --duration-ultra: 150ms;
  --duration-moderate: 220ms;
  --duration-slow: 320ms;

  --ease-out-quad: cubic-bezier(0.25, 0.46, 0.45, 0.94);
  --ease-in-out-expo: cubic-bezier(0.87, 0, 0.13, 1);
  --ease-soft-spring: cubic-bezier(0.2, 0.8, 0.2, 1);
  --ease-page: cubic-bezier(0.22, 1, 0.36, 1);
}

/* 可选：保持 v3 的默认边框颜色行为 */
@layer base {
  *,
  ::after,
  ::before,
  ::backdrop,
  ::file-selector-button {
    border-color: var(--color-gray-200, currentcolor);
  }
}

/* v4：示例自定义容器工具（如需）
@utility container {
  margin-inline: auto;
  padding-inline: 2rem;
}
*/

/* Route transition layers */
.route-container { contain: layout paint; isolation: isolate; overflow: hidden; }
.route-layer { min-height: 100dvh; background: var(--color-background-light); contain: paint; }
.dark .route-layer { background: var(--color-background-dark); }
.route-enter { position: relative; }
.route-exit { pointer-events: none; }
/* 合成优化，避免闪烁 */
.route-enter, .route-exit { will-change: transform; backface-visibility: hidden; transform: translateZ(0); }

/* Drawer-like horizontal stack transitions */
/* Forward (push): new page slides in from right on top; previous stays still */
.route-enter.is-animating.dir-forward { position: absolute; inset: 0; z-index: 10; animation: hmSlideInCover 560ms var(--ease-page) both; }
.route-exit.dir-forward { position: relative; z-index: 0; /* no animation */ }
/* Back (pop): current (top) page slides out to right; revealed page stays still */
.route-enter.is-animating.dir-back { position: relative; z-index: 0; /* no animation */ }
.route-exit.dir-back { position: absolute; inset: 0; z-index: 10; animation: hmSlideOutRight 560ms var(--ease-page) both; }

/* 注意：仅在 is-animating 时由关键帧控制 transform，避免非动画时页面被基线位移推出视口 */
@keyframes hmSlideInCover { from { transform: translate3d(100%, 0, 0); } to { transform: translate3d(0, 0, 0); } }
@keyframes hmSlideOutRight { from { transform: translate3d(0, 0, 0); } to { transform: translate3d(100%, 0, 0); } }

/* Custom scrollbar styles and overrides that were in index.html */
.custom-scrollbar::-webkit-scrollbar {
  width: 6px;
  height: 6px;
}
.custom-scrollbar::-webkit-scrollbar-track {
  background: transparent;
}
.custom-scrollbar::-webkit-scrollbar-thumb {
  background-color: rgba(0, 0, 0, 0.2);
  border-radius: 6px;
}
.dark .custom-scrollbar::-webkit-scrollbar-thumb {
  background-color: rgba(255, 255, 255, 0.2);
}

/* Dynamic scrollbar visibility for chat area */
.chat-scroll.hide-scrollbar {
  scrollbar-width: none; /* Firefox */
}
.chat-scroll.show-scrollbar {
  scrollbar-width: thin; /* Firefox */
}
.chat-scroll.custom-scrollbar.hide-scrollbar::-webkit-scrollbar {
  width: 0px; /* Chrome/Safari/Edge */
  height: 0px;
}
.chat-scroll.custom-scrollbar.show-scrollbar::-webkit-scrollbar {
  width: 6px; /* match default */
  height: 6px;
}

/* Disable browser scroll anchoring to avoid unexpected jumps to top
   when content above changes or virtualized measurements update */
.chat-scroll {
  overflow-anchor: none;
}

.chat-footer-safe {
  padding-bottom: calc(0.75rem + env(safe-area-inset-bottom));
}

@supports (padding: constant(safe-area-inset-bottom)) {
  .chat-footer-safe {
    padding-bottom: calc(0.75rem + constant(safe-area-inset-bottom));
  }
}

/* Global transitions */
button, a, input, textarea, label[for] {
  transition: background-color 0.2s ease-in-out, color 0.2s ease-in-out, border-color 0.2s ease-in-out, opacity 0.2s ease-in-out;
}

/* Global body styles */
body {
  min-height: 100vh;
  min-height: 100dvh;
  /* Disable text selection globally for a better mobile experience */
  -webkit-user-select: none; /* Safari */
  -moz-user-select: none; /* Firefox */
  -ms-user-select: none; /* IE10+/Edge */
  user-select: none; /* Standard */
}

/* Mobile viewport optimization - handle address bar and keyboard */
:root {
  --hm-viewport-height: 100vh;
  --hm-keyboard-height: 0px;
}

@supports (height: 100dvh) {
  :root {
    --hm-viewport-height: 100dvh;
  }
}

.h-viewport {
  height: var(--hm-viewport-height);
}

.min-h-viewport {
  min-height: var(--hm-viewport-height);
}

.max-h-viewport {
  max-height: var(--hm-viewport-height);
}

/* Mobile keyboard adaptivity - make containers adjust to visual viewport */
@media (max-width: 768px) {
  .mobile-viewport-container {
    height: var(--hm-viewport-height);
    min-height: var(--hm-viewport-height);
    max-height: var(--hm-viewport-height);
    /* Smooth transition when keyboard appears/disappears */
    transition: height 0.2s ease-out;
  }

  /* When virtual keyboard is shown, this helps maintain layout */
  @supports (-webkit-touch-callout: none) {
    /* iOS-specific adjustments */
    .mobile-viewport-container {
      height: -webkit-fill-available;
      min-height: -webkit-fill-available;
    }
  }
}

/* Removed skeleton shimmer styles for instant render experience */

/* Material Symbols font settings */
.material-symbols-outlined {
  font-variation-settings: 'FILL' 0, 'wght' 400, 'GRAD' 0, 'opsz' 24;
}

/* Re-enable text selection for specific elements where it's needed */
input, textarea, .selectable-text {
  -webkit-user-select: text;
  -moz-user-select: text;
  -ms-user-select: text;
  user-select: text;
}

/* Generic Collapsible Checkbox */
input.collapsible-checkbox {
  display: none;
}
.collapsible-content {
  display: none;
}
input.collapsible-checkbox:checked ~ .collapsible-content {
  display: block;
}
input.collapsible-checkbox:checked ~ label .collapsible-icon {
  transform: rotate(180deg);
}
.collapsible-icon {
  transition: transform 0.2s ease-in-out;
}

/* Notes Drawer Styles */
#notes-content {
  /* 使用独立变换属性以获得流畅曲线动画 */
  translate: 0 100%;
  opacity: 0;
  pointer-events: none;
  will-change: translate, opacity;
  /* 更柔和：更长时长 + 软弹性曲线，透明度略微延迟 */
  transition: translate 340ms var(--ease-soft-spring) 0ms, opacity 240ms ease-out 40ms;
}
#notes-drawer:checked ~ #notes-content {
  translate: 0 0;
  opacity: 1;
  pointer-events: auto;
}
#notes-drawer:checked ~ div #notes-tab {
  display: none;
}
#notes-tab .material-symbols-outlined {
  transition: transform 0.3s ease-in-out;
}
#notes-drawer:checked ~ div #notes-tab .material-symbols-outlined {
  transform: rotate(0deg);
}
/* Reduce flashing of the underneath layer by temporarily freezing its repaint */
.route-exit.dir-forward, .route-enter.dir-back {
  filter: contrast(1);
}
.route-exit.dir-forward *, .route-enter.dir-back * {
  contain: paint;
}

/* Touch feedback for list items and interactive elements */
[data-pressing='true'] {
  background-color: rgba(0, 0, 0, 0.08);
  transition: background-color var(--duration-ultra, 150ms) ease-out;
}

.dark [data-pressing='true'] {
  background-color: rgba(255, 255, 255, 0.12);
}

/* Message bubble specific touch feedback */
[data-message-bubble='true'][data-pressing='true'] {
  background-color: transparent;
}

.user-bubble,
.ai-bubble {
  transition: filter var(--duration-ultra, 150ms) ease-out;
}

[data-message-bubble='true'][data-pressing='true'] .user-bubble,
[data-message-bubble='true'][data-pressing='true'] .ai-bubble {
  filter: brightness(1.05);
}

.dark [data-message-bubble='true'][data-pressing='true'] .user-bubble,
.dark [data-message-bubble='true'][data-pressing='true'] .ai-bubble {
  filter: brightness(1.1);
}

button[role='menuitem'] {
  transition: background-color var(--duration-ultra, 150ms) ease-out;
}

button[role='menuitem']:active {
  background-color: rgba(0, 0, 0, 0.12);
}

.dark button[role='menuitem']:active {
  background-color: rgba(255, 255, 255, 0.16);
}

button[role='menuitem']:focus-visible,
div[role='button']:focus-visible {
  outline: 2px solid rgba(0, 0, 0, 0.38);
  outline-offset: 2px;
}

.dark button[role='menuitem']:focus-visible,
.dark div[role='button']:focus-visible {
  outline-color: rgba(255, 255, 255, 0.55);
}

/* Word breaking utility for long content */
.wrap-break-word {
  overflow-wrap: anywhere;
  word-break: break-word;
}

/* KaTeX display blocks should scroll within bubbles on small screens */
.katex-display {
  overflow-x: auto;
  overflow-y: hidden;
  max-width: 100%;
  padding-bottom: 0.75rem;
}
.katex-display::-webkit-scrollbar {
  height: 6px;
}
.katex-display::-webkit-scrollbar-thumb {
  background-color: rgba(0, 0, 0, 0.2);
  border-radius: 6px;
}
.dark .katex-display::-webkit-scrollbar-thumb {
  background-color: rgba(255, 255, 255, 0.2);
}
